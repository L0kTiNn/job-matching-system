<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∞–∫–∞–Ω—Å–∏–∏ - –†–∞–±–æt–∞Plus</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="index.html" class="logo" style="text-decoration: none;">–†–∞–±–æ—Ç–∞<span>Plus</span></a>
            <ul class="nav-links">
                <li><a href="vacancies.html" style="color: #ff6b35;">–í–∞–∫–∞–Ω—Å–∏–∏</a></li>
                <li><a href="my-resume.html">–ú–æ—ë —Ä–µ–∑—é–º–µ</a></li>
                <li><a href="profile.html">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
            </ul>
            <div class="nav-actions">
                <div class="search-box">
                    <input type="text" placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å –∏–ª–∏ –∫–æ–º–ø–∞–Ω–∏—è" id="searchInput">
                    <span><img src="static/images/lupa.jpg" width="20" height="20"></span>
                </div>
                <a href="create-resume.html" class="btn-register">
                    –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑—é–º–µ ‚Üí
                </a>
            </div>
        </nav>
    </header>

    <!-- Vacancies Section -->
    <div class="container" style="margin-top: 60px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;">
            <h1 class="section-title" style="margin: 0;"> –í—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h1>
            <select id="sortSelect" style="padding: 12px 20px; border-radius: 8px; border: 2px solid #e0e0e0; font-size: 15px;">
                <option value="new">–ù–æ–≤—ã–µ</option>
                <option value="salary_high">–ó–∞—Ä–ø–ª–∞—Ç–∞: –≤—ã—Å–æ–∫–∞—è</option>
                <option value="salary_low">–ó–∞—Ä–ø–ª–∞—Ç–∞: –Ω–∏–∑–∫–∞—è</option>
            </select>
        </div>

        <div id="vacanciesList" class="vacancies-grid">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π...</div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        // Load vacancies
        async function loadVacancies() {
            try {
                const response = await fetch(`${API_URL}/api/vacancies/all`);

                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞–∫–∞–Ω—Å–∏–π');
                }

                const vacancies = await response.json();
                displayVacancies(vacancies);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('vacanciesList').innerHTML = `
                    <div class="error-message">
                        –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω.
                    </div>
                `;
            }
        }

        // Display vacancies
        function displayVacancies(vacancies) {
            const container = document.getElementById('vacanciesList');

            if (!vacancies || vacancies.length === 0) {
                container.innerHTML = '<div class="loading">–í–∞–∫–∞–Ω—Å–∏–π –ø–æ–∫–∞ –Ω–µ—Ç. <a href="create-vacancy.html">–°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</a></div>';
                return;
            }

            container.innerHTML = vacancies.map(vacancy => `
                <div class="vacancy-card">
                    <h3 class="vacancy-title">${vacancy.title}</h3>
                    ${vacancy.description ? `
                        <p class="vacancy-company">${vacancy.description.substring(0, 150)}...</p>
                    ` : ''}
                    <div class="vacancy-details">
                        <div class="detail-item">
                            üìç ${vacancy.location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
                        </div>
                    </div>
                    <div class="vacancy-salary">
                        ${formatSalary(vacancy.salary_min, vacancy.salary_max)}
                    </div>
                    <button class="btn-primary" style="margin-top: 20px; width: 100%;" onclick="viewVacancy(${vacancy.id})">
                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                </div>
            `).join('');
        }

        // Format salary
        function formatSalary(min, max) {
            if (!min && !max) return '–ó–∞—Ä–ø–ª–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
            if (min && max) return `${min.toLocaleString()} - ${max.toLocaleString()} ‚ÇΩ`;
            if (min) return `–æ—Ç ${min.toLocaleString()} ‚ÇΩ`;
            return `–¥–æ ${max.toLocaleString()} ‚ÇΩ`;
        }

        // View vacancy
        function viewVacancy(id) {
            alert(`–ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∞–∫–∞–Ω—Å–∏–∏ #${id}. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.`);
        }

        // Search
        document.getElementById('searchInput')?.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.vacancy-card');

            cards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(query) ? 'block' : 'none';
            });
        });

        // Load on page load
        loadVacancies();
    </script>
</body>
</html>
